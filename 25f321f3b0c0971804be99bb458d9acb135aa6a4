{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "a779a214_6dd680d9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1935515
      },
      "writtenOn": "2022-07-12T09:42:38Z",
      "side": 1,
      "message": "The alternative method to this is create the control socket in virtualizationservice and pass the FD to crosvm. That\u0027s how all files are passed. It would need some crosvm changes. It would simplify or eliminate the sepolicy changes.\ngo/pkvm-host-reclaim",
      "revId": "25f321f3b0c0971804be99bb458d9acb135aa6a4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2dfdd81f_c80ac8dc",
        "filename": "private/crosvm.te",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2022-07-14T18:55:53Z",
      "side": 1,
      "message": "I wonder...\n\nThis is the data type for the virtualization service. Does it make sense to give crosvm so much control over another security domain\u0027s data.\n\nThe way this type of control socket is handled elsewhere in Android is to add the \"socket\" entry into the service\u0027s init.rc file. That places the socket into /dev/socket and init manages creation/destruction. I would prefer that we do the same, although that might mean adding support for init to create vsock sockets.  \n\nhttps://cs.android.com/android/platform/superproject/+/master:system/core/init/README.md",
      "range": {
        "startLine": 42,
        "startChar": 13,
        "endLine": 42,
        "endChar": 48
      },
      "revId": "25f321f3b0c0971804be99bb458d9acb135aa6a4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "acf651b4_f953b3e0",
        "filename": "private/crosvm.te",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2022-07-19T14:23:24Z",
      "side": 1,
      "message": "I don\u0027t think this is a vsock.\n\nBut it looks like it is created by crosvm (which is spawned by vs) rather than vs itself (which is a service started by init).\n\nAnd on the third hand, Keir said \"The alternative method to this is create the control socket in virtualizationservice and pass the FD to crosvm.\" Which sounds preferbnle.",
      "parentUuid": "2dfdd81f_c80ac8dc",
      "range": {
        "startLine": 42,
        "startChar": 13,
        "endLine": 42,
        "endChar": 48
      },
      "revId": "25f321f3b0c0971804be99bb458d9acb135aa6a4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dbf8e257_321fe7c6",
        "filename": "private/crosvm.te",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1935515
      },
      "writtenOn": "2022-07-29T10:14:32Z",
      "side": 1,
      "message": "Well I do agree it\u0027s giving a lot of power to crosvm. A lot more than should be needed.\n\nThe service that spawns crosvm processes is virtualizationservice, so it makes sense that it could create and destroy the socket (which is a purely host-side Unix domain socket) and pass one end off.\n\nI don\u0027t think init needs to be involved, fortunately.",
      "parentUuid": "2dfdd81f_c80ac8dc",
      "range": {
        "startLine": 42,
        "startChar": 13,
        "endLine": 42,
        "endChar": 48
      },
      "revId": "25f321f3b0c0971804be99bb458d9acb135aa6a4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3a690a94_b3427818",
        "filename": "private/crosvm.te",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2022-07-29T10:31:32Z",
      "side": 1,
      "message": "SGTM. Is creating it in VS the plan then?",
      "parentUuid": "dbf8e257_321fe7c6",
      "range": {
        "startLine": 42,
        "startChar": 13,
        "endLine": 42,
        "endChar": 48
      },
      "revId": "25f321f3b0c0971804be99bb458d9acb135aa6a4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0ece24be_0ef74b33",
        "filename": "private/crosvm.te",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1935515
      },
      "writtenOn": "2022-10-05T09:08:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3a690a94_b3427818",
      "range": {
        "startLine": 42,
        "startChar": 13,
        "endLine": 42,
        "endChar": 48
      },
      "revId": "25f321f3b0c0971804be99bb458d9acb135aa6a4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fe81be5a_073384b2",
        "filename": "private/crosvm.te",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2022-07-12T02:06:13Z",
      "side": 1,
      "message": "I don\u0027t know if create implies open. Alan, do you know?",
      "range": {
        "startLine": 44,
        "startChar": 57,
        "endLine": 44,
        "endChar": 63
      },
      "revId": "25f321f3b0c0971804be99bb458d9acb135aa6a4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c92089e7_4e448ea9",
        "filename": "private/crosvm.te",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1935515
      },
      "writtenOn": "2022-07-14T15:21:35Z",
      "side": 1,
      "message": "I couldn\u0027t find an implies relationship documented anywhere. And lots of Android sepolicy explicitly lists both permissions.",
      "parentUuid": "fe81be5a_073384b2",
      "range": {
        "startLine": 44,
        "startChar": 57,
        "endLine": 44,
        "endChar": 63
      },
      "revId": "25f321f3b0c0971804be99bb458d9acb135aa6a4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fbcdf2ac_e5266d92",
        "filename": "private/crosvm.te",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2022-07-14T15:28:52Z",
      "side": 1,
      "message": "Ok, they why did you put only create, but not open? Is that based on the actual denials you experienced when things are correctly working while setenforce is set to 0?",
      "parentUuid": "c92089e7_4e448ea9",
      "range": {
        "startLine": 44,
        "startChar": 57,
        "endLine": 44,
        "endChar": 63
      },
      "revId": "25f321f3b0c0971804be99bb458d9acb135aa6a4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a59e1e56_f24f2498",
        "filename": "private/crosvm.te",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2022-07-14T18:55:53Z",
      "side": 1,
      "message": "Does it work? Pass tests? If so I guess only create is needed.",
      "parentUuid": "fbcdf2ac_e5266d92",
      "range": {
        "startLine": 44,
        "startChar": 57,
        "endLine": 44,
        "endChar": 63
      },
      "revId": "25f321f3b0c0971804be99bb458d9acb135aa6a4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "be0d8dc4_6312ca25",
        "filename": "private/crosvm.te",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2022-07-19T14:23:24Z",
      "side": 1,
      "message": "create doesn\u0027t imply open, AFAICT.",
      "parentUuid": "a59e1e56_f24f2498",
      "range": {
        "startLine": 44,
        "startChar": 57,
        "endLine": 44,
        "endChar": 63
      },
      "revId": "25f321f3b0c0971804be99bb458d9acb135aa6a4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a2ea86b3_d0f65201",
        "filename": "private/crosvm.te",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1935515
      },
      "writtenOn": "2022-07-29T10:14:32Z",
      "side": 1,
      "message": "Oh I see what you mean. Well indeed it does work. This is the minimal set of perms I needed to successfully create and use the control socket, with selinux enabled.",
      "parentUuid": "a59e1e56_f24f2498",
      "range": {
        "startLine": 44,
        "startChar": 57,
        "endLine": 44,
        "endChar": 63
      },
      "revId": "25f321f3b0c0971804be99bb458d9acb135aa6a4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}