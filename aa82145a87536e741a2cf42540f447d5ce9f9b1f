{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "eb73dd9c_667819f3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-07-12T13:46:59Z",
      "side": 1,
      "message": "\u003cgeneral agreement with Jeff\u003e",
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9cc564eb_29fc88e5",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2023-07-12T13:39:43Z",
      "side": 1,
      "message": "why system_app_data_file? Are you actually using the private app data dir?",
      "range": {
        "startLine": 162,
        "startChar": 101,
        "endLine": 162,
        "endChar": 121
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "762cd5bb_08db05f8",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2023-07-12T13:39:43Z",
      "side": 1,
      "message": "why system?",
      "range": {
        "startLine": 162,
        "startChar": 5,
        "endLine": 162,
        "endChar": 11
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "179dcbb7_8560f438",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2023-07-12T13:39:43Z",
      "side": 1,
      "message": "Does this even make sense when combined with mlstrustedsubject?\n\n+alanstokes",
      "range": {
        "startLine": 162,
        "startChar": 132,
        "endLine": 162,
        "endChar": 135
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "840b14af_ecd46998",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-07-12T13:46:59Z",
      "side": 1,
      "message": "You have to specify something, but you won\u0027t be able to use it.",
      "parentUuid": "179dcbb7_8560f438",
      "range": {
        "startLine": 162,
        "startChar": 132,
        "endLine": 162,
        "endChar": 135
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "078f06d0_09eff8b0",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-07-12T13:46:59Z",
      "side": 1,
      "message": "Having mlstrustedsubject blocks any access to app private data anyway, so it probably doesn\u0027t matter.",
      "parentUuid": "9cc564eb_29fc88e5",
      "range": {
        "startLine": 162,
        "startChar": 101,
        "endLine": 162,
        "endChar": 121
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "73bdbf46_2bc60729",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-07-12T13:46:59Z",
      "side": 1,
      "message": "Agreed. Does this app really need to run as the system user? Ideally we\u0027d be having less code in system, not more.",
      "parentUuid": "762cd5bb_08db05f8",
      "range": {
        "startLine": 162,
        "startChar": 5,
        "endLine": 162,
        "endChar": 11
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9732c584_d0213329",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1143408
      },
      "writtenOn": "2023-07-13T09:50:30Z",
      "side": 1,
      "message": "Not using the data dir (at least not planned) What is the better alternative ?",
      "parentUuid": "078f06d0_09eff8b0",
      "range": {
        "startLine": 162,
        "startChar": 101,
        "endLine": 162,
        "endChar": 121
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ebe2719c_4aa6d433",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1143408
      },
      "writtenOn": "2023-07-13T09:50:30Z",
      "side": 1,
      "message": "The service is called from the system, so I thought it made sense to keep it as is. Would it be better to define a new user ?",
      "parentUuid": "73bdbf46_2bc60729",
      "range": {
        "startLine": 162,
        "startChar": 5,
        "endLine": 162,
        "endChar": 11
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b1b2baa5_8eb2f5b5",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1143408
      },
      "writtenOn": "2023-07-13T09:50:30Z",
      "side": 1,
      "message": "I don\u0027t know what levelFrom and mlstrustedsubject actually are. I know I needed the mlstrustedsubject to get rid of some denial.",
      "parentUuid": "840b14af_ecd46998",
      "range": {
        "startLine": 162,
        "startChar": 132,
        "endLine": 162,
        "endChar": 135
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e46d68d5_c64646a1",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-07-13T10:26:36Z",
      "side": 1,
      "message": "Not using the data dir is fine. If you want to use it, you can\u0027t be mlstrustedsubject. \n\nEither way there shouldn\u0027t be a need to use system_app_data_file here; normal app_data_file should be fine.",
      "parentUuid": "9732c584_d0213329",
      "range": {
        "startLine": 162,
        "startChar": 101,
        "endLine": 162,
        "endChar": 121
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dce80c91_d4878aee",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-07-13T10:26:36Z",
      "side": 1,
      "message": "levelFrom decides whether the app (and its data directory) benefit from User and uid separation; levelFrom\u003dall gives both. This is generally a good thing - other apps will not be able to access your data or processes.\nmlstrustedsubject says you want to be exempt from those protections and access anything owned by any user or uid. (But we don\u0027t allow such apps to access any private app data at all, not even their own, otherwise it would be a huge security hole.)\nWith great power comes great responsibility - if you can access data in any user, you must make sure you don\u0027t inadvertently leak information between users.",
      "parentUuid": "b1b2baa5_8eb2f5b5",
      "range": {
        "startLine": 162,
        "startChar": 132,
        "endLine": 162,
        "endChar": 135
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "de5507c3_0d7b7cd9",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-07-13T10:26:36Z",
      "side": 1,
      "message": "Can it just be a normal app user (\"user\u003d_app\")? See e.g. traceur_app above.\n\nThe system user is quite highly privileged, so ideally use something else.",
      "parentUuid": "ebe2719c_4aa6d433",
      "range": {
        "startLine": 162,
        "startChar": 5,
        "endLine": 162,
        "endChar": 11
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f352ce04_6771ea2a",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1143408
      },
      "writtenOn": "2023-07-19T16:56:48Z",
      "side": 1,
      "message": "Changed to app_data_file. Thanks for the suggestion.",
      "parentUuid": "e46d68d5_c64646a1",
      "range": {
        "startLine": 162,
        "startChar": 101,
        "endLine": 162,
        "endChar": 121
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9f795999_c5233919",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1143408
      },
      "writtenOn": "2023-07-19T16:56:48Z",
      "side": 1,
      "message": "Removed mlstrustedsubject subject with the other changes below seems to work.",
      "parentUuid": "dce80c91_d4878aee",
      "range": {
        "startLine": 162,
        "startChar": 132,
        "endLine": 162,
        "endChar": 135
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "79464059_fbcb0f29",
        "filename": "private/seapp_contexts",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1143408
      },
      "writtenOn": "2023-07-19T16:56:48Z",
      "side": 1,
      "message": "As discussed offline:\n\nI tried to set the _app user in the seapp_context, I also removed theÂ  android:sharedUserId\u003d\"android.uid.system\" of my Manifest but now I\u0027m getting a \"java.lang.SecurityException: App UIDs cannot add services.\"\n\nI can\u0027t use a classic android service since it needs to be named according to the camera HAL convention (android.hardware.camera.provider.ICameraProvider/virtual/0). So I think the only way is to use ServiceManager.addService, which is reserved for the system.",
      "parentUuid": "de5507c3_0d7b7cd9",
      "range": {
        "startLine": 162,
        "startChar": 5,
        "endLine": 162,
        "endChar": 11
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c692cb68_203b1835",
        "filename": "private/virtual_camera.te",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1054468
      },
      "writtenOn": "2023-07-12T13:39:43Z",
      "side": 1,
      "message": "I think we need a better explanation for this.",
      "range": {
        "startLine": 4,
        "startChar": 45,
        "endLine": 4,
        "endChar": 46
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d976cbc1_d902cb65",
        "filename": "private/virtual_camera.te",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-07-12T13:46:59Z",
      "side": 1,
      "message": "+1.\nIf this does need to act cross-user then the app is responsible for ensuring there is no cross-user leakage. But in general apps should not be acting cross user.",
      "parentUuid": "c692cb68_203b1835",
      "range": {
        "startLine": 4,
        "startChar": 45,
        "endLine": 4,
        "endChar": 46
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "84c9a784_8edfc845",
        "filename": "private/virtual_camera.te",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1143408
      },
      "writtenOn": "2023-07-13T09:50:30Z",
      "side": 1,
      "message": "It\u0027s been a while since I added this so I don\u0027t remember exactly why. \n\nLooking through my notes, it seems that I had the following error and adding mlstrustedsubject solved it.\n\n\n```\nauditd  : type\u003d1400 audit(0.0:57): avc: denied { write } for comm\u003d\".virtual.camera\" name\u003d\"android.companion.virtual.camera-dBo\n4QlblQ566WEIyy-YYZQ\u003d\u003d\" dev\u003d\"dm-44\" ino\u003d24159 scontext\u003du:r:virtual_camera:s0:c232,c259,c512,c768 tcontext\u003du:object_r:apk_data_file:s0 tclass\u003ddir permissive\u003d1 \n```\n\nI will need to double check tomorrow what happens if I remove it.",
      "parentUuid": "d976cbc1_d902cb65",
      "range": {
        "startLine": 4,
        "startChar": 45,
        "endLine": 4,
        "endChar": 46
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "44c9033b_add5910e",
        "filename": "private/virtual_camera.te",
        "patchSetId": 1
      },
      "lineNbr": 4,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-07-13T10:26:36Z",
      "side": 1,
      "message": "That\u0027s a very weird denial. You\u0027re being blocked from modifying a directory under /data/app - but you really shouldn\u0027t be doing that anyway. APKs should only be modified by a handful of core processes.\n\nBut even with mlstrustedsubject I would expect such an access to be blocked - you\u0027re not granting it here, and there are neverallows preventing you from doing so.\n\nAnyway, removing mlstrustedsubject and seeing what problems it reveals seems like a good next step.",
      "parentUuid": "84c9a784_8edfc845",
      "range": {
        "startLine": 4,
        "startChar": 45,
        "endLine": 4,
        "endChar": 46
      },
      "revId": "aa82145a87536e741a2cf42540f447d5ce9f9b1f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}