{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "ff170783_63cd9737",
        "filename": "private/crosvm.te",
        "patchSetId": 5
      },
      "lineNbr": 12,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2021-07-13T11:33:29Z",
      "side": 1,
      "message": "nit: r_file_perms already includes lock\n(I should have mentioned that before, but I didn\u0027t notice)",
      "range": {
        "startLine": 12,
        "startChar": 65,
        "endLine": 12,
        "endChar": 69
      },
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c74a7896_5ec5cc4f",
        "filename": "private/crosvm.te",
        "patchSetId": 5
      },
      "lineNbr": 12,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-07-13T11:36:15Z",
      "side": 1,
      "message": "Didn\u0027t notice that. Thanks!",
      "parentUuid": "ff170783_63cd9737",
      "range": {
        "startLine": 12,
        "startChar": 65,
        "endLine": 12,
        "endChar": 69
      },
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9233527b_974d8e21",
        "filename": "private/crosvm.te",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1380243
      },
      "writtenOn": "2021-07-13T11:54:53Z",
      "side": 1,
      "message": "The composite disk images are already passed as file descriptors, so `open` shouldn\u0027t be needed. Where is the directory search permission needed?",
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1bc9ed58_5fd9a28f",
        "filename": "private/crosvm.te",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-07-13T12:27:45Z",
      "side": 1,
      "message": "These allow rules are based on the actual denials that I saw.\n\nThe `open` seems to be the same case as b/193402941. But why do we pass even the composite disks as FDs? The composite disk files themselves (not the backing files) are created by the AIDL service. So, I think granting `open` to crosvm is not harmful.\n\nI don\u0027t know where in crosvm the search permission is needed. I saw the denial and added this without much doubt. I didn\u0027t try to look into crosvm because this didn\u0027t look harmful at all.",
      "parentUuid": "9233527b_974d8e21",
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fa89b20e_e92a13e5",
        "filename": "private/crosvm.te",
        "patchSetId": 5
      },
      "lineNbr": 16,
      "author": {
        "id": 1380243
      },
      "writtenOn": "2021-07-13T11:54:53Z",
      "side": 1,
      "message": "We already have `allow crosvm apk_data_file:file { getattr read };` below, what other permissions does it need? It shouldn\u0027t need `open`, because they should be passed as file descriptors.\n\nMove these rules down with the other `allow crosvm ...:file` rules in any case.",
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a9fb4043_8f4a0753",
        "filename": "private/crosvm.te",
        "patchSetId": 5
      },
      "lineNbr": 16,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-07-13T12:27:45Z",
      "side": 1,
      "message": "Merged the two lines. `open` seems to be the same case as b/193402941. I\u0027ve added a TODO comment.",
      "parentUuid": "fa89b20e_e92a13e5",
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "52c020d9_f8f05432",
        "filename": "private/crosvm.te",
        "patchSetId": 5
      },
      "lineNbr": 18,
      "author": {
        "id": 1380243
      },
      "writtenOn": "2021-07-13T11:54:53Z",
      "side": 1,
      "message": "It\u0027s already allowed getattr, read and write below. Are they other permissions (e.g. ioctl) really needed?\n\nIf so, I don\u0027t think it should be restricted to userdebug/eng builds, we\u0027ll want to run tests on (rooted) production builds too won\u0027t we?",
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "88e9c3fb_61cc8638",
        "filename": "private/crosvm.te",
        "patchSetId": 5
      },
      "lineNbr": 18,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-07-13T12:27:45Z",
      "side": 1,
      "message": "open is needed. I changed it to r_file_perms as per Alan.\n\nRestricting this to userdebug/eng is preferred as we have a neverallow rule like the below:\n\nneverallow { domain -adbd and a few } shell_data_file:file open;\n\nOn production builds, we will run instrumented apk tests which don\u0027t use /data/local/tmp.",
      "parentUuid": "52c020d9_f8f05432",
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d0ac8cd1_7d6c2bd4",
        "filename": "private/crosvm.te",
        "patchSetId": 5
      },
      "lineNbr": 34,
      "author": {
        "id": 1380243
      },
      "writtenOn": "2021-07-13T11:54:53Z",
      "side": 1,
      "message": "Nit: start comment with a capital letter, like the other comments.",
      "range": {
        "startLine": 34,
        "startChar": 2,
        "endLine": 34,
        "endChar": 7
      },
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4b5d69c9_593b107e",
        "filename": "private/crosvm.te",
        "patchSetId": 5
      },
      "lineNbr": 34,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-07-13T12:27:45Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d0ac8cd1_7d6c2bd4",
      "range": {
        "startLine": 34,
        "startChar": 2,
        "endLine": 34,
        "endChar": 7
      },
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9f9bd382_b0a06740",
        "filename": "private/domain.te",
        "patchSetId": 5
      },
      "lineNbr": 570,
      "author": {
        "id": 1380243
      },
      "writtenOn": "2021-07-13T11:54:53Z",
      "side": 1,
      "message": "I don\u0027t think we should need to allow virtualizationservice or crosvm to open shell_data_file, they should be opened by the `vm` tool or test and passed as a file descriptor.",
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "afdca190_f43b6e0c",
        "filename": "private/domain.te",
        "patchSetId": 5
      },
      "lineNbr": 570,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-07-13T12:27:45Z",
      "side": 1,
      "message": "Replied in the other thread.",
      "parentUuid": "9f9bd382_b0a06740",
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "952bb7c7_8b20d7ef",
        "filename": "private/virtualizationservice.te",
        "patchSetId": 5
      },
      "lineNbr": 75,
      "author": {
        "id": 1380243
      },
      "writtenOn": "2021-07-13T11:54:53Z",
      "side": 1,
      "message": "Why is this needed? The file should be opened by the client and passed by FD, not virtualizationservice.",
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5f56eef1_8654c397",
        "filename": "private/virtualizationservice.te",
        "patchSetId": 5
      },
      "lineNbr": 75,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-07-13T12:27:45Z",
      "side": 1,
      "message": "This is b/193402941",
      "parentUuid": "952bb7c7_8b20d7ef",
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a8128f20_698dceb6",
        "filename": "private/virtualizationservice.te",
        "patchSetId": 5
      },
      "lineNbr": 75,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-07-14T13:48:53Z",
      "side": 1,
      "message": "I found that virtualzationservice had the same problem as crosvm; /proc/self/fd/N is opened.\n\naops/1766026 fixes this. The open permissions are removed from virtualizationservice.te. I will do the same for crosvm.te when your crosvm change lands on aosp.",
      "parentUuid": "5f56eef1_8654c397",
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "13c39951_10164eec",
        "filename": "private/virtualizationservice.te",
        "patchSetId": 5
      },
      "lineNbr": 78,
      "author": {
        "id": 1380243
      },
      "writtenOn": "2021-07-13T11:54:53Z",
      "side": 1,
      "message": "I guess this is for tests and the `vm` tool? Is there any issue with allowing it in prod builds too?",
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c14ac275_a8f41bea",
        "filename": "private/virtualizationservice.te",
        "patchSetId": 5
      },
      "lineNbr": 78,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-07-13T12:27:45Z",
      "side": 1,
      "message": "Replied in the other thread.",
      "parentUuid": "13c39951_10164eec",
      "revId": "f30fd09d84aa39a9aa5e0775c52c8a09ef5c66ca",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}