{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "1646c5db_d015e047",
        "filename": "private/system_server.te",
        "patchSetId": 5
      },
      "lineNbr": 592,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2024-04-02T15:58:58Z",
      "side": 1,
      "message": "Can you add why you need signal permission?\nI don\u0027t think anything here relates to command line arguments (selinux doesn\u0027t restrict that).",
      "range": {
        "startLine": 592,
        "startChar": 0,
        "endLine": 592,
        "endChar": 94
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c58f5184_63ea837b",
        "filename": "private/system_server.te",
        "patchSetId": 5
      },
      "lineNbr": 592,
      "author": {
        "id": 1935010
      },
      "writtenOn": "2024-04-02T21:29:35Z",
      "side": 1,
      "message": "moved signal out of this grouping and added the reason for needing it in a comment.",
      "parentUuid": "1646c5db_d015e047",
      "range": {
        "startLine": 592,
        "startChar": 0,
        "endLine": 592,
        "endChar": 94
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5ad28ce6_93a60ca6",
        "filename": "private/system_server.te",
        "patchSetId": 5
      },
      "lineNbr": 592,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2024-04-03T10:52:04Z",
      "side": 1,
      "message": "TBH I preferred it in one group, with an overall comment.",
      "parentUuid": "c58f5184_63ea837b",
      "range": {
        "startLine": 592,
        "startChar": 0,
        "endLine": 592,
        "endChar": 94
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ab343b98_5c0644c3",
        "filename": "private/system_server.te",
        "patchSetId": 5
      },
      "lineNbr": 596,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2024-04-02T15:58:58Z",
      "side": 1,
      "message": "Why do you need this? How does system_server receive a trace_redactor fd? Or access a trace_redactor owned fifo_file?\n\n(I can understand the rules the other way round.)",
      "range": {
        "startLine": 596,
        "startChar": 0,
        "endLine": 596,
        "endChar": 42
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "31ee99de_45a66426",
        "filename": "private/system_server.te",
        "patchSetId": 5
      },
      "lineNbr": 596,
      "author": {
        "id": 1040443
      },
      "writtenOn": "2024-04-02T16:10:21Z",
      "side": 1,
      "message": "signal is required for aborting the process if takes too long (think of ctrl-c)\nFD is required both way for stdin+stdout communication.",
      "parentUuid": "ab343b98_5c0644c3",
      "range": {
        "startLine": 596,
        "startChar": 0,
        "endLine": 596,
        "endChar": 42
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "72815f04_d79c9a54",
        "filename": "private/system_server.te",
        "patchSetId": 5
      },
      "lineNbr": 596,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2024-04-02T16:18:26Z",
      "side": 1,
      "message": "\u003e signal is required for aborting the process if takes too long (think of ctrl-c)\n\nYeah, but it would be good to include that in the comment (since it can be used for other purposes).\n\n\u003e FD is required both way for stdin+stdout communication.\n\nIt isn\u0027t; the child inherits fds from the parent, so needs parent:fd use, but the parent doesn\u0027t get an fd from the child, at least not as part of the exec.\n\nAnd the fifo used would be owned by system_server, not by trace_redactor.",
      "parentUuid": "31ee99de_45a66426",
      "range": {
        "startLine": 596,
        "startChar": 0,
        "endLine": 596,
        "endChar": 42
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e6408863_5de63603",
        "filename": "private/system_server.te",
        "patchSetId": 5
      },
      "lineNbr": 596,
      "author": {
        "id": 1935010
      },
      "writtenOn": "2024-04-02T21:29:35Z",
      "side": 1,
      "message": "removed the FD allow line and reran the CUJ and it worked fine. I assumed I need to add FD access both ways.  This is good to know, thank you!",
      "parentUuid": "72815f04_d79c9a54",
      "range": {
        "startLine": 596,
        "startChar": 0,
        "endLine": 596,
        "endChar": 42
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6b91593e_884640e4",
        "filename": "private/system_server.te",
        "patchSetId": 5
      },
      "lineNbr": 596,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2024-04-03T10:52:04Z",
      "side": 1,
      "message": "I also think you can delete `allow system_server trace_redactor:fifo_file {read write};` - the fifo is owned by system_server and we need to allow trace_redactor to access it (which you do below), but again it\u0027s not symmetric.",
      "parentUuid": "e6408863_5de63603",
      "range": {
        "startLine": 596,
        "startChar": 0,
        "endLine": 596,
        "endChar": 42
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4d07d1f4_15ea93cd",
        "filename": "private/system_server.te",
        "patchSetId": 5
      },
      "lineNbr": 1328,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2024-04-02T15:58:58Z",
      "side": 1,
      "message": "This makes me nervous.\n\nWhy is this being run directly by system_server? When is it?\nWhat access to system server data does it need?",
      "range": {
        "startLine": 1326,
        "startChar": 0,
        "endLine": 1328,
        "endChar": 100
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c9fa5f42_35fa438e",
        "filename": "private/system_server.te",
        "patchSetId": 5
      },
      "lineNbr": 1328,
      "author": {
        "id": 1040443
      },
      "writtenOn": "2024-04-02T16:09:23Z",
      "side": 1,
      "message": "doesn\u0027t this suggest it\u0027s running trhough a domain transition (Which would effectively drop the ss privileges?)\n\ntrace_redactor is a platform binary that takes a system trace and filters out everything but the app-specific data that we want to give back to the app.",
      "parentUuid": "4d07d1f4_15ea93cd",
      "range": {
        "startLine": 1326,
        "startChar": 0,
        "endLine": 1328,
        "endChar": 100
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5ca27569_1da3000a",
        "filename": "private/system_server.te",
        "patchSetId": 5
      },
      "lineNbr": 1328,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2024-04-02T16:18:26Z",
      "side": 1,
      "message": "Why is it being run by system server though? (There is very little context here or on the bug.)\n\nRunning it in its own domain is definitely a good thing. But spawning it from system server is unusual, as you can see from the limited number of exemptions here.",
      "parentUuid": "c9fa5f42_35fa438e",
      "range": {
        "startLine": 1326,
        "startChar": 0,
        "endLine": 1328,
        "endChar": 100
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c3f9530_81cf9b74",
        "filename": "private/system_server.te",
        "patchSetId": 5
      },
      "lineNbr": 1328,
      "author": {
        "id": 1170070
      },
      "writtenOn": "2024-04-02T17:22:12Z",
      "side": 1,
      "message": "Ah, apologies for the lack of context! So this is part of the go/devtelemetryapis feature, where we\u0027re allowing apps access to collect profiling data via Perfetto (via system server).\n\nThe profiling data can be a few different types (trace/stack sampling/etc). If a trace is collected, we need to filter the trace through this redaction process so that information about other processes isn\u0027t included in the output data. Other types, like stack sampling, only collect data about the process in question so the redaction doesn\u0027t apply.\n\nThe setup that we\u0027re trying to support here is for the system server module to:\n1 - Collect the trace via calling Perfetto (you may remember our past selinux reviews for this!)\n2 - Pass the trace to the new redactor process, where we filter out the info about other processes and output a new, redacted trace file.\n\nSo we\u0027re wanting to give system server the permission to manage the trace redactor because it\u0027s managing this whole process.\n\nOur goal would not specifically be to give trace redactor all of the privileges held by system server (we don\u0027t need that) - just the ones needed to interact with it via command line and to input and output traces, which will be in the profiling data directory.",
      "parentUuid": "5ca27569_1da3000a",
      "range": {
        "startLine": 1326,
        "startChar": 0,
        "endLine": 1328,
        "endChar": 100
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9cec8cbf_55f686b5",
        "filename": "private/system_server.te",
        "patchSetId": 5
      },
      "lineNbr": 1328,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2024-04-03T10:52:04Z",
      "side": 1,
      "message": "Normally we use services started by init for native processes, but I can see this is a bit different.\n\nIt would be good to expand the comment above, to explain why perfetto \u0026 trace_redactor are run directly.",
      "parentUuid": "3c3f9530_81cf9b74",
      "range": {
        "startLine": 1326,
        "startChar": 0,
        "endLine": 1328,
        "endChar": 100
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1206a44c_e6ccb15c",
        "filename": "private/trace_redactor.te",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2024-04-02T15:58:58Z",
      "side": 1,
      "message": "Why do you need write access? That feels wrong.",
      "range": {
        "startLine": 13,
        "startChar": 61,
        "endLine": 13,
        "endChar": 80
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d2ece514_abf9f420",
        "filename": "private/trace_redactor.te",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1040443
      },
      "writtenOn": "2024-04-02T16:09:23Z",
      "side": 1,
      "message": "I assume because it takes a trace as input and creates a new (filtered) trace as  output",
      "parentUuid": "1206a44c_e6ccb15c",
      "range": {
        "startLine": 13,
        "startChar": 61,
        "endLine": 13,
        "endChar": 80
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2650e8db_d5220c46",
        "filename": "private/trace_redactor.te",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2024-04-02T16:18:26Z",
      "side": 1,
      "message": "In the same directory? If you\u0027re ok with that, it\u0027s fine by me. Having multiple writers can make life more complicated.",
      "parentUuid": "d2ece514_abf9f420",
      "range": {
        "startLine": 13,
        "startChar": 61,
        "endLine": 13,
        "endChar": 80
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a0a35fb3_17128661",
        "filename": "private/trace_redactor.te",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1935010
      },
      "writtenOn": "2024-04-02T21:29:35Z",
      "side": 1,
      "message": "Yes the reads and writes happen in the same directory.  Primiano\u0027s comment is correct, the trace_redactor will take in a trace and output a filtered trace.",
      "parentUuid": "2650e8db_d5220c46",
      "range": {
        "startLine": 13,
        "startChar": 61,
        "endLine": 13,
        "endChar": 80
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "81bf7e8e_a3086aa9",
        "filename": "private/trace_redactor.te",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2024-04-03T10:52:04Z",
      "side": 1,
      "message": "You don\u0027t have permission to modify the directory though - so you\u0027re limited to overwriting existing files (I think).\n\nOr is system server opening/creating the files for you and passing the fds? If that\u0027s the case, you should only need `allow trace_redactor perfetto_traces_profiling_data_file:file { read write };` and `allow trace_redactor perfetto_traces_data_file:file read;`, with no open/create or directory permission needed. (Feel free to add getattr and ioctl as well.)\n\nThat\u0027s a good and fairly common sepolicy idiom.",
      "parentUuid": "a0a35fb3_17128661",
      "range": {
        "startLine": 13,
        "startChar": 61,
        "endLine": 13,
        "endChar": 80
      },
      "revId": "43a53474e57594fa9b9387f1fe12e0f88c73550a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}